"use strict";const body=document.body,header=document.querySelector(".header"),menuBurger=document.querySelector(".header__burger"),hmLinks=document.querySelectorAll(".header-nav ul li a"),contactBtn=document.querySelector(".contacts-btn"),contactBox=document.querySelector(".contacts-box"),backing=(contactBtn.addEventListener("click",t=>{t.stopPropagation(),contactBox.classList.toggle("show"),contactBtn.classList.toggle("show")}),document.addEventListener("click",t=>{contactBox.contains(t.target)||contactBtn.contains(t.target)||(contactBox.classList.remove("show"),contactBtn.classList.remove("show"))}),document.querySelector(".backing")),stopPopup=document.querySelector("#stop-popup"),stopPopupCloseBtn=document.querySelector(".stop-popup__close-btn"),musicPopups=document.querySelectorAll(".music-popup"),ticketsBtn=document.querySelector(".tickets-btn"),cardPopup=document.querySelector("#card-popup"),cardPopupCloseBtn=document.querySelector(".card-popup__close-btn"),inputs=document.querySelectorAll(".form-box input"),popupMap={berlin:"#berlin",paris:"#paris",amsterdam:"#amsterdam",prague:"#prague",vienna:"#vienna",lisbon:"#lisbon"};Object.entries(popupMap).forEach(([t,e])=>{const s=document.querySelector(e);document.querySelectorAll(`[data-city="${t}"]`).forEach(t=>{t.addEventListener("click",()=>{backing.classList.add("show"),s.classList.add("show"),body.classList.add("no-scroll"),s.querySelector(".stop-popup__close-btn").addEventListener("click",()=>{backing.classList.remove("show"),s.classList.remove("show"),body.classList.remove("no-scroll")},{once:!0})})})}),backing.addEventListener("click",t=>{t.target===backing&&(backing.classList.remove("show"),document.body.classList.remove("no-scroll"),document.querySelectorAll(".popup.show").forEach(t=>{t.classList.remove("show")}))});for(let t of musicPopups)t.addEventListener("click",t=>{t.stopPropagation()});ticketsBtn.addEventListener("click",()=>{backing.classList.add("show"),cardPopup.classList.add("show"),body.classList.add("no-scroll")}),inputs.forEach(t=>{t.addEventListener("click",t=>{t.stopPropagation(),backing.classList.add("show"),stopPopup.classList.add("show"),body.classList.add("no-scroll")})}),backing.addEventListener("click",t=>{t.stopPropagation(),backing.classList.remove("show"),stopPopup.classList.remove("show"),cardPopup.classList.remove("show"),sanysPopup.classList.remove("show"),chizhPopup.classList.remove("show"),donPopup.classList.remove("show"),omskPopup.classList.remove("show"),kazanPopup.classList.remove("show"),tumenPopup.classList.remove("show"),body.classList.remove("no-scroll")}),stopPopup.addEventListener("click",t=>{t.stopPropagation()}),cardPopup.addEventListener("click",t=>{t.stopPropagation()}),stopPopupCloseBtn.addEventListener("click",()=>{backing.classList.remove("show"),stopPopup.classList.remove("show"),cardPopup.classList.remove("show"),body.classList.remove("no-scroll")}),cardPopupCloseBtn.addEventListener("click",()=>{backing.classList.remove("show"),cardPopup.classList.remove("show"),body.classList.remove("no-scroll")}),document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".music-button").forEach(t=>{const e=t.closest(".music-popup").querySelector(".music-audio");t.addEventListener("click",()=>{e.paused?(document.querySelectorAll(".music-audio").forEach(t=>{t.paused||(t.pause(),(t=t.closest(".music-popup").querySelector(".music-button")).textContent="Слушать",t.classList.remove("playing"))}),e.play(),t.textContent="Остановить",t.classList.add("playing")):(e.pause(),t.textContent="Слушать",t.classList.remove("playing"))}),e.addEventListener("ended",()=>{t.textContent="Слушать",t.classList.remove("playing")})})}),document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector(".hero-section");var t=new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting&&e.classList.add("visible")})},{threshold:.3});e&&t.observe(e)}),document.addEventListener("DOMContentLoaded",()=>{var t=document.querySelectorAll(".grid-item");const e=new IntersectionObserver(t=>{t.forEach((t,e)=>{t.isIntersecting&&setTimeout(()=>{t.target.classList.add("visible")},e%2==0?200:400)})},{threshold:.05});t.forEach(t=>e.observe(t))}),document.addEventListener("DOMContentLoaded",()=>{var t=document.querySelectorAll(".line-up-item");const e=new IntersectionObserver(t=>{t.forEach((t,e)=>{t.isIntersecting&&setTimeout(()=>{t.target.classList.add("visible")},300*e)})},{threshold:.2});t.forEach(t=>e.observe(t))}),document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector(".bag-section");var t=new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting&&e.classList.add("visible")})},{threshold:.3});e&&t.observe(e)}),document.addEventListener("DOMContentLoaded",()=>{var t=document.querySelectorAll(".authors-item");const e=new IntersectionObserver(t=>{t.forEach((t,e)=>{t.isIntersecting&&setTimeout(()=>{t.target.classList.add("visible")},200*e)})},{threshold:.2});t.forEach(t=>e.observe(t))});class Bird{constructor(t){this.canvas=t.canvas,this.gl=this.canvas.getContext("webgl",{alpha:!0}),this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.shaders={bird:{vertex:this.compileShader(this.gl.VERTEX_SHADER,t.shaders.bird.vertex),fragment:this.compileShader(this.gl.FRAGMENT_SHADER,t.shaders.bird.fragment)},dots:{vertex:this.compileShader(this.gl.VERTEX_SHADER,t.shaders.dots.vertex),fragment:this.compileShader(this.gl.FRAGMENT_SHADER,t.shaders.dots.fragment)},trackdots:{vertex:this.compileShader(this.gl.VERTEX_SHADER,t.shaders.trackdots.vertex),fragment:this.compileShader(this.gl.FRAGMENT_SHADER,t.shaders.trackdots.fragment)},trackdots2:{vertex:this.compileShader(this.gl.VERTEX_SHADER,t.shaders.trackdots2.vertex),fragment:this.compileShader(this.gl.FRAGMENT_SHADER,t.shaders.trackdots2.fragment)}},this.cameraOptions={zoom:.3,angleY:.4*Math.PI,angleX:0},this.programs={bird:null,dots:null},this.calculateMatrices(),this.createBirdGeometry(),this.createPrograms(),this.updateCanvasUniforms(),this.updateMatrixUniforms(),this.initEventListeners(),this.updateCanvasSize(),requestAnimationFrame(this.animate.bind(this))}calculateMatrices(){this.modelMatrix=[1,0,0,0,0,1,0,0,0,0,1,0,-4,-.5,0,1];var t=this.cameraOptions.zoom,e=this.cameraOptions.angleY,s=this.cameraOptions.angleX,t=(this.viewMatrix=[t*Math.cos(s),0,t*-Math.sin(s),0,t*-Math.sin(e)*Math.sin(s),t*Math.cos(e),t*-Math.sin(e)*Math.cos(s),0,t*Math.cos(e)*Math.sin(s),t*Math.sin(e),t*Math.cos(e)*Math.cos(s),0,0,0,0,1],1/Math.tan(90*Math.PI/360));this.projectionMatrix=[t,0,0,0,0,t,0,0,0,0,-10/11,-1,0,0,10/11,1]}createBirdGeometry(){var s=[];for(let e=0;e<=8;e+=.4)for(let t=0;t<=1;t+=.2)0===t&&(s.push(e),s.push(t),s.push(e+.4),s.push(t)),s.push(e+.4),s.push(t),s.push(e+.4),s.push(t+.2),s.push(e+.4),s.push(t+.2),s.push(e),s.push(t+.2),s.push(e),s.push(t+.2),s.push(e),s.push(t),s.push(e),s.push(t),s.push(e+.4),s.push(t+.2);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.gl.createBuffer()),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(s),this.gl.STATIC_DRAW)}compileShader(t,e){t=this.gl.createShader(t);return this.gl.shaderSource(t,e),this.gl.compileShader(t),t}createPrograms(){this.createProgramByName("bird"),this.createProgramByName("dots"),this.createProgramByName("trackdots"),this.createProgramByName("trackdots2")}createProgramByName(t){this.programs[t]=this.gl.createProgram(),this.gl.attachShader(this.programs[t],this.shaders[t].vertex),this.gl.attachShader(this.programs[t],this.shaders[t].fragment),this.gl.linkProgram(this.programs[t]);t=this.gl.getAttribLocation(this.programs[t],"a_position");this.gl.enableVertexAttribArray(t),this.gl.vertexAttribPointer(t,2,this.gl.FLOAT,!1,0,0)}updateMatrixUniforms(){this.updateMatrixUniformsForProgram(this.programs.bird),this.updateMatrixUniformsForProgram(this.programs.dots),this.updateMatrixUniformsForProgram(this.programs.trackdots),this.updateMatrixUniformsForProgram(this.programs.trackdots2)}updateMatrixUniformsForProgram(t){this.gl.useProgram(t),this.gl.uniformMatrix4fv(this.gl.getUniformLocation(t,"u_model_matrix"),!1,this.modelMatrix),this.gl.uniformMatrix4fv(this.gl.getUniformLocation(t,"u_view_matrix"),!1,this.viewMatrix),this.gl.uniformMatrix4fv(this.gl.getUniformLocation(t,"u_projection_matrix"),!1,this.projectionMatrix)}updateCanvasUniforms(){this.updateCanvasUniformsForProgram(this.programs.bird),this.updateCanvasUniformsForProgram(this.programs.dots),this.updateCanvasUniformsForProgram(this.programs.trackdots),this.updateCanvasUniformsForProgram(this.programs.trackdots2)}updateCanvasUniformsForProgram(t){this.gl.useProgram(t),this.gl.uniform1f(this.gl.getUniformLocation(t,"u_canvas_height"),this.canvas.height),this.gl.uniform1f(this.gl.getUniformLocation(t,"u_canvas_width"),this.canvas.width)}updateTimeUniform(t){this.updateTimeUniformForProgram(this.programs.bird,t),this.updateTimeUniformForProgram(this.programs.dots,t),this.updateTimeUniformForProgram(this.programs.trackdots,t),this.updateTimeUniformForProgram(this.programs.trackdots2,t)}updateTimeUniformForProgram(t,e){this.gl.useProgram(t),this.gl.uniform1f(this.gl.getUniformLocation(t,"u_time"),e/1e3)}updateCanvasSize(){window.innerWidth/window.innerHeight>12/9?(this.canvas.width=Math.ceil(window.innerHeight*(12/9)),this.canvas.height=Math.ceil(window.innerHeight)):(this.canvas.width=Math.ceil(window.innerWidth),this.canvas.height=Math.ceil(window.innerWidth/(12/9))),this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height),this.updateCanvasUniforms()}updateCameraAngles(t,e){t=(t-window.innerWidth/2)/window.innerWidth,e=(e-window.innerHeight/2)/window.innerHeight;this.cameraOptions.angleY=.4*Math.PI+e/4,this.cameraOptions.angleX=t,this.calculateMatrices(),this.updateMatrixUniforms()}initEventListeners(){window.addEventListener("resize",this.updateCanvasSize.bind(this)),document.body.addEventListener("mousemove",t=>{this.updateCameraAngles(t.clientX,t.clientY)})}animate(t){this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.updateTimeUniform(t),this.gl.useProgram(this.programs.trackdots),this.gl.drawArrays(this.gl.POINTS,0,1e3),this.gl.useProgram(this.programs.bird),this.gl.drawArrays(this.gl.LINES,0,1e3),this.gl.useProgram(this.programs.dots),this.gl.drawArrays(this.gl.POINTS,0,1e3),this.gl.useProgram(this.programs.trackdots2),this.gl.drawArrays(this.gl.POINTS,0,1e3),requestAnimationFrame(this.animate.bind(this))}}const myBird=new Bird({canvas:document.getElementById("bird-canvas"),shaders:{bird:{vertex:document.getElementById("bird-vertex-shader").textContent,fragment:document.getElementById("bird-fragment-shader").textContent},dots:{vertex:document.getElementById("bird-dots-vertex-shader").textContent,fragment:document.getElementById("bird-dots-fragment-shader").textContent},trackdots:{vertex:document.getElementById("bird-trackdots-vertex-shader").textContent,fragment:document.getElementById("bird-trackdots-fragment-shader").textContent},trackdots2:{vertex:document.getElementById("bird-trackdots2-vertex-shader").textContent,fragment:document.getElementById("bird-trackdots2-fragment-shader").textContent}}});